---
description: Create new draft components or prototypes following Code-First-Design patterns
globs: ["**/*.tsx", "**/*.ts"]
---

# Creating draft components and prototypes

This rule guides you through creating either a draft component or a prototype. First, determine what you're creating:

- **Component**: An individual UI piece (button, card, form, etc.) that will be previewed in the design system
- **Prototype**: A full application flow or complete page that demonstrates how multiple components work together

---

## Creating a component

Components are individual UI pieces managed through three registries.

### How the system works

1. **`registry.ts`** - Lists components with metadata (name, path, category) for navigation. The `/proto` landing page reads this to show all available components.

2. **`component-registry.ts`** - Imports component code and defines default props. Used for validation and safe rendering with fallback behaviour.

3. **`COMPONENT_DEMOS` in `[slug]/page.tsx`** - Maps component slugs to React render functions. This is what actually renders the component preview when someone visits `/proto/components/<kebab-name>`.

When you create a component, you must update all three registries. Once complete, the component will appear in the design system at `/proto` and be viewable at `/proto/components/<kebab-name>`. Draft components can only be imported in `/proto` routes (ESLint enforces this).

### Steps

1) Create `components/draft/<Name>.tsx` (PascalCase, one export).

2) Use a `interface Props { ... }` and export `defaultProps`:
   ```ts
   export interface ExampleCardProps {
     title?: string;
     description?: string;
   }
   
   export const defaultProps: ExampleCardProps = {
     title: "Default Title",
     description: "Default description",
   };
   ```

3) Prefer Server Components; add `'use client'` only when required.

4) Compose from `components/ui/*` (shadcn primitives) where possible. Follow design principles in `design.mdc`.

5) Add demo renderer to `app/proto/components/[slug]/page.tsx` in the `COMPONENT_DEMOS` object:
   ```tsx
   // In app/proto/components/[slug]/page.tsx
   const COMPONENT_DEMOS: Record<string, () => React.ReactElement> = {
     '<kebab-name>': () => <Name {...defaultProps} />,
     // ... other demos
   };
   ```
   Note: The `[slug]` route is a dynamic route that handles all component demos. You don't create individual page files.

6) Register in `app/proto/_ds/registry.ts` under `draftComponents`:
   ```ts
   draftComponents: [
     { 
       name: "<Name>", 
       path: "/proto/components/<kebab-name>", 
       file: "components/draft/<Name>.tsx" 
     }
   ]
   ```

7) Add a demo config entry in `app/proto/_ds/component-registry.ts`:
   First import the component and defaultProps at the top of the file:
   ```ts
   import { <Name> } from '@/components/draft/<Name>';
   import { defaultProps } from '@/components/draft/<Name>';
   ```
   
   Then add the config entry to the `COMPONENT_CONFIGS` object:
   ```ts
   export const COMPONENT_CONFIGS: Record<string, ComponentDemoConfig> = {
     '<kebab-name>': {
       componentName: '<Name>',
       component: <Name>,
       defaultProps: defaultProps,
       fallbackMessage: '<Name> failed to render.',
     },
     // ... other configs
   };
   ```

---

## Creating a prototype

Prototypes are full application flows that live at `app/proto/prototypes/[name]/page.tsx`. Unlike components, they don't need `component-registry.ts` or `COMPONENT_DEMOS` - they're complete pages, not component demos.

### Before you start

Think through these questions before creating your prototype:

1. **What's the purpose of this prototype?**
   - What user flow or experience are you demonstrating?
   - Is it a landing page, workspace, dashboard, or something else?

2. **What components does it need?**
   - List all the components required for this prototype
   - Are these new components or existing ones?
   - If new, where should they live? Consider `components/draft/[prototype-name]/` for organisation

3. **What's the route structure?**
   - Does it need a landing page that leads to a workspace?
   - Or does it go straight to the main flow?
   - Does it need nested routes? (e.g., `/prototypes/workspace/[id]`)

4. **Component organisation:**
   - New components for this prototype should live in `components/draft/[prototype-name]/`
   - Create them using this same rule (components section above)
   - Prototypes can import draft components freely

### Steps

1) Create the route structure at `app/proto/prototypes/<kebab-name>/page.tsx`:

```tsx
'use client'; // or Server Component if no interactivity

import { ProtoHeader } from '@/app/proto/_components/ProtoHeader';
// Import your components here

export default function <Name>Page() {
  return (
    <>
      <ProtoHeader
        component={{
          name: '<Name>',
          type: 'Prototype',
        }}
      />
      {/* Your prototype content here */}
    </>
  );
}
```

2) Determine what components you need:
   - List all components required for this prototype
   - Check if they already exist or need to be created
   - If new components are needed, create them using this same rule (components section above)
   - New components should live in `components/draft/<prototype-name>/` for organisation

3) Build the prototype page:
   - Import your components (draft components can be imported freely in `/proto` routes)
   - Structure the layout and flow
   - Add any necessary state, routing, or interactivity

4) Register in `app/proto/_ds/registry.ts` under the `prototypes` array:

```ts
prototypes: [
  { 
    name: "<Name>", 
    path: "/proto/prototypes/<kebab-name>", 
    description: "Optional description of what this prototype demonstrates"
  },
  // ... other prototypes
]
```

Note: Prototypes only need `registry.ts` - they don't need `component-registry.ts` or `COMPONENT_DEMOS` because they're full pages, not component demos.

5) If you need nested routes (e.g., `/prototypes/workspace/[id]`), create additional route files:
   - `app/proto/prototypes/<name>/[id]/page.tsx` for dynamic routes
   - `app/proto/prototypes/<name>/layout.tsx` for shared layouts

6) Test the prototype by visiting `/proto/prototypes/<kebab-name>` in your browser.

### Example structure

For a prototype called "Analyst Workspace":
- Route: `app/proto/prototypes/analyst-workspace/page.tsx`
- Components: `components/draft/analyst-workspace/WorkspaceLayout.tsx`, `AnalystSidebar.tsx`, etc.
- Registry entry: `{ name: "Analyst Workspace", path: "/proto/prototypes/analyst-workspace", description: "AI-powered research workspace" }`
